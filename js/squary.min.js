var Squary={container:null,elements:null,resolution:4,randomize:!1,transitionTime:.7,pixelCorrection:!1,_size:!1,_debug:!1,_grid:[],_firstLaunch:!0,"new":function(e,t,s,i,r,n){if(this._debug)var l=new Date;if(this.container=document.querySelector(e),null==this.container)return void console.log("%c Squary Error : The container is not existing or mispelled.","color: red;");if(this.elements=Array.prototype.slice.call(this.container.children),this.elements.length<=0)return void console.log("%c Squary Error : No elements found. Make sure to set correcly your container. It will take automatically the children.","color: red;");if(this.resolution=t,this.randomize=s,this.transitionTime=i,this.pixelCorrection=r,this.randomize){for(var o=this.elements.length;o>=0;--o)this.container.appendChild(this.elements[Math.random()*o|0]);this.elements=this.container.children}this.container.style.position="relative";for(var o=0;o<this.elements.length;o++)this.elements[o].style.position="absolute",this.elements[o].style.top=0,this.elements[o].style.left=0,this.elements[o].style.display="none";this.refresh();var h=this,a=function(){var e=0;return function(t,s){clearTimeout(e),e=setTimeout(t,s)}}();if(window.addEventListener("resize",function(){a(function(){h.refresh()},200)}),this._debug){var m=new Date,u=m.getTime()-l.getTime();console.log("Timer:",name,"finished in",u,"ms")}return console.log("%c Squary's running fine! ","color: darkgreen; background:lightgreen;"),n(),this},refresh:function(){this._grid=[];for(var e=[],t=0;t<this.elements.length;t++)this.elements[t].hasAttribute("squary-hidden")?(this.elements[t].style.opacity=0,this.elements[t].style.zIndex=-1):(this.elements[t].style.opacity=1,this.elements[t].style.zIndex=1,this.elements[t].style.top="0px",e.push(this.elements[t]));this.elements=e;for(var s=0,i=1,r=1,t=0;t<this.elements.length;t++){var n=this.elements[t].getAttribute("squary-size");n?(n=n.split("x"),n[0]>i&&(i=n[0]),n[1]>r&&(r=n[1]),n=n[0]*n[1],s+=n):s++}this._size=Math.round(this.resolution*this.container.offsetWidth/1024),this._size<i&&(this._size=i),this._debug&&(console.log("%c Squary debug : Number of elements : "+s,"color: darkorange;"),console.log("%c Squary debug : Grid size is : "+this._size+" x "+(parseInt(s/this._size)+1),"color: darkorange;"));for(var t=0;t<parseInt(s/this._size)+r;t++){this._grid[t]=[0];for(var l=0;l<this._size;l++)this._grid[t][l]=0}var o=parseInt(this.container.offsetWidth)/this._size;this.container.style.height=(parseInt(s/this._size)+2)*o+"px";for(var h=0;h<this.elements.length;h++){var a=-1,m=0,u=0,c=0,f=0,d=0,g=this.elements[h].getAttribute("squary-size");g?(g=g.split("x"),f=g[0],d=g[1]):f=d=1;do{a<this._size-1?a++:(a=0,m++),u=0,c=0;for(var y=0;f>y&&0==this._grid[m][a+y];y++)u++;if(u==f)for(var l=0;d>l&&0==this._grid[m+l][a];l++)c++}while(u*c!=f*d);for(var y=0;f>y;y++)for(var l=0;d>l;l++)this._grid[m+l][a+y]=f*d;var v=0,p=0;v=o*f,p=o*d;var _=0;this.pixelCorrection&&(_=1),this.elements[h].style.width=v+_+"px",this.elements[h].style.height=p+_+"px";var b="translate("+o*a+"px,"+o*m+"px) rotateX(0deg)";this._firstLaunch&&(this._recursiveDisplay(h,b),b="translate("+o*a+"px,"+(o*m+o)+"px) rotateX(90deg)"),this.elements[h].style.WebkitTransform=b,this.elements[h].style.msTransform=b,this.elements[h].style.transform=b}return this._firstLaunch=!1,this._debug&&this._drawDebugGrid(this._grid),this},onClick:function(e){for(var t=0;t<this.elements.length;t++)this.elements[t].onclick=e;return this},filter:function(e){if(isNaN(e)){if(this.elements=Array.prototype.slice.call(this.container.children),"all"==e)for(var t=0;t<this.elements.length;t++)this.elements[t].removeAttribute("squary-hidden");else for(var t=0;t<this.elements.length;t++){var s=this.elements[t].getAttribute("squary-filter");if(this.elements[t].hasAttribute("squary-filter")&&e==s)this.elements[t].removeAttribute("squary-hidden");else{this.elements[t].setAttribute("squary-hidden","true");var i=this.elements[t].getAttribute("style").split("translate(")[1].split(") ")[0],r="translate("+i+") scale(0.7)";this.elements[t].style.WebkitTransform=r,this.elements[t].style.msTransform=r,this.elements[t].style.transform=r,this.elements[t].style.opacity=0}}if("all"!=e){var n=this;setTimeout(function(){n.refresh()},200)}else this.refresh();return this}},getBlock:function(e){return this.elements[e]},setResolution:function(e){return this.resolution=e,this.refresh(),this},setTransitionTime:function(e){return this.transitionTime=e,this.refresh(),this},_recursiveDisplay:function(e,t){var s="all "+this.transitionTime+"s ease-out",i=this;this.elements[e].style.display="inline-block",setTimeout(function(){i.elements[e].style.WebkitTransition=s,i.elements[e].style.msTransition=s,i.elements[e].style.transition=s,i.elements[e].style.WebkitTransform=t,i.elements[e].style.msTransform=t,i.elements[e].style.transform=t},1e3*this.transitionTime/this.elements.length*(e+1))},_drawDebugGrid:function(){this.container.innerHTML="SQUARY DEBUG GRID :<br />";for(var e=0;e<this._grid.length;e++){for(var t=0;t<this._grid[e].length;t++)this.container.innerHTML+=this._grid[e][t],this.container.innerHTML+=" | ";this.container.innerHTML+="<br />"}}};
